@model IEnumerable<NRL_PROJECT.Models.ObstacleReportViewModel>
@using System.Globalization

@{
    // Bruk bred layout bare her (fjern hvis du valgte globalt i _Layout.cshtml)
    Layout = "_Layout";

    var ci = CultureInfo.InvariantCulture;
    var list = Model.ToList();

    int cNy = list.Count(x => x.ReportStatus == NRL_PROJECT.Models.ReportStatus.Ny);
    int cVenter = list.Count(x => x.ReportStatus == NRL_PROJECT.Models.ReportStatus.Venter);
    int cUnder = list.Count(x => x.ReportStatus == NRL_PROJECT.Models.ReportStatus.UnderBehandling);
    int cGodkjent = list.Count(x => x.ReportStatus == NRL_PROJECT.Models.ReportStatus.Godkjent);
    int cAvvist = list.Count(x => x.ReportStatus.ToString() == "Avvist"); // hvis du har enum-verdi Avvist
}


<div class="grid grid-cols-1 gap-6 lg:grid-cols-12">
    <!-- Venstre: filtre -->
    <aside class="lg:col-span-3">
        <div class="rounded-2xl border bg-white p-4">
            <h2 class="mb-3 text-sm font-semibold text-slate-800">Filtre</h2>
            <div class="flex flex-col gap-1">
                <a asp-action="RegistrarView" class="rounded px-2 py-2 hover:bg-slate-50">Alle</a>
                <a asp-action="RegistrarView" asp-route-status="Ny" class="rounded px-2 py-2 hover:bg-slate-50">Ny</a>
                <a asp-action="RegistrarView" asp-route-status="Underbehandling" class="rounded px-2 py-2 hover:bg-slate-50">Under behandling</a>
                <a asp-action="RegistrarView" asp-route-status="Godkjent" class="rounded px-2 py-2 hover:bg-slate-50">Godkjent</a>
                <a asp-action="RegistrarView" asp-route-status="Avvist" class="rounded px-2 py-2 hover:bg-slate-50">Avvist</a>
            </div>

            <div class="my-4 border-t"></div>

            <form method="get" class="flex gap-2">
                <input name="q" value="@Context.Request.Query["q"]"
                       class="w-full rounded-xl border px-3 py-2 text-sm"
                       placeholder="Søk ID, type, bruker..." />
                <button class="rounded-xl bg-sky-600 px-3 text-white hover:bg-sky-700">Søk</button>
            </form>
        </div>
    </aside>

    <!-- Høyre: liste -->
    <section class="lg:col-span-9">
        <div class="mb-3 flex items-center justify-between">
            <h1 class="text-lg font-semibold text-slate-900">Innrapporterte hinder</h1>
            <a asp-action="RegistrarView" class="rounded-xl border px-3 py-2 text-sm hover:bg-slate-50">Oppdater</a>
        </div>

        <div class="space-y-3">
            @foreach (var r in Model)
            {
                <a asp-controller="Registrar" asp-action="ReportDetails" asp-route-id="@r.ReportId"
                   class="block rounded-2xl border bg-white p-4 transition hover:shadow-md">
                    <div class="flex items-start justify-between gap-3">
                        <div class="min-w-0">
                            <div class="font-semibold text-sky-700">Rapport #@r.ReportId</div>

                            <div class="mt-0.5 text-base font-medium text-slate-900">
                                @r.ObstacleType
                            </div>

                            <div class="mt-1 text-sm text-slate-600">
                                @r.Latitude, @r.Longitude
                                <span class="mx-2">•</span>
                                <span class="text-slate-500">Innmeldt:</span> @r.TimeOfSubmittedReport.ToString("dd.MM.yyyy HH:mm")
                            </div>

                            <div class="mt-1 text-sm text-slate-600">
                                <span class="text-slate-500">Innsender (UserId):</span> @r.UserId
                                @if (!string.IsNullOrWhiteSpace(r.UserName))
                                {
                                    <span class="text-slate-400">— @r.UserName</span>
                                }
                            </div>

                            @if (!string.IsNullOrWhiteSpace(r.ObstacleDescription))
                            {
                                <p class="mt-2 line-clamp-2 text-sm text-slate-700">@r.ObstacleDescription</p>
                            }
                        </div>
                        <div class="mt-2">
                            @await Html.PartialAsync("_StatusTag", r.ReportStatus)
                        </div>
                        <div class="shrink-0">
                            @await Html.PartialAsync("_StatusTag", r.ReportStatus)
                        </div>
                    </div>
                </a>
            }
        </div>
    </section>
</div>


