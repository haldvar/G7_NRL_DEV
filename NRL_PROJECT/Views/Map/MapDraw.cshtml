@model NRL_PROJECT.Models.MapData

<h2 class="text-2xl font-bold text-purple-700 mb-4">Draw on the map</h2>
<div id="mapDraw" style="height: 400px;" class="rounded shadow mb-6"></div>

<form method="post" asp-action="Submit" asp-controller="Map">
    <input type="hidden" id="geoInput" name="GeoJsonCoordinates" />
    <button type="submit" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">
        Submit Drawing
    </button>
</form>

@section Scripts {
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-draw/dist/leaflet.draw.js"></script>
    <script>
        const map = L.map('mapDraw').setView([58.333, 8.233], 13);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

        const drawnItems = new L.FeatureGroup();
        map.addLayer(drawnItems);

        const drawControl = new L.Control.Draw({
            edit: { featureGroup: drawnItems },
            draw: {
                polygon: false,
                circle: false,
                rectangle: false,
                marker: true,
                polyline: true
            }
        });
        map.addControl(drawControl);

        map.on('draw:created', function (e) {
            drawnItems.clearLayers(); // Only one drawing at a time
            drawnItems.addLayer(e.layer);

            const geojson = e.layer.toGeoJSON();
            document.getElementById('geoInput').value = JSON.stringify(geojson.geometry.coordinates);
        });
    </script>

}