@model NRL_PROJECT.Models.MapData

<div class="max-w-6xl mx-auto px-4 py-10">
    <!-- Title -->
    <h2 class="text-4xl md:text-5xl font-extrabold text-purple-700 mb-6 text-center">
        🖊️ Draw on the Map
    </h2>
    <p class="text-gray-600 text-center mb-10 text-lg md:text-xl">
        Use the tools to add a marker or line. Only one drawing is saved at a time.
    </p>

    <!-- Map Card -->
    <div class="bg-white rounded-3xl shadow-2xl p-6 mb-8">
        <div id="mapDraw" class="rounded-2xl border border-gray-200 shadow-inner" style="height: 700px;"></div>
        <p class="text-base md:text-lg text-gray-500 mt-3">
            Toolbar (top-left) lets you add or edit drawings. Removing replaces your saved drawing.
        </p>
    </div>

    <!-- Form with buttons -->
    <form method="post" asp-action="Submit" asp-controller="Map" class="flex flex-col md:flex-row justify-center space-y-4 md:space-y-0 md:space-x-6">
        <input type="hidden" id="geoInput" name="GeoJsonCoordinates" />

        <button type="submit"
                class="bg-green-600 text-white px-12 py-5 rounded-2xl font-semibold text-2xl md:text-3xl shadow-xl hover:bg-green-700 hover:shadow-2xl transition">
            ✅ Submit Drawing
        </button>

        <a asp-action="Index" asp-controller="Home"
           class="bg-gray-600 text-white px-12 py-5 rounded-2xl font-semibold text-2xl md:text-3xl shadow-xl hover:bg-gray-700 hover:shadow-2xl transition">
            ❌ Cancel
        </a>
    </form>
</div>

@section Styles {
    <style>
        /* Større Leaflet Draw toolbar knapper */
        .leaflet-draw .leaflet-draw-toolbar {
            top: 10px; /* litt margin fra toppen */
            left: 10px;
        }

            .leaflet-draw .leaflet-draw-toolbar a {
                width: 60px !important;
                height: 60px !important;
                line-height: 60px !important;
                font-size: 2rem !important; /* større ikoner */
                border-radius: 1rem !important; /* rundere hjørner */
                margin-bottom: 4px !important;
            }

                .leaflet-draw .leaflet-draw-toolbar a span {
                    transform: scale(1.8); /* gjør selve ikonet større */
                }

        /* Gjør hele toolbaren mer “touch friendly” */
        .leaflet-draw-toolbar-top {
            padding: 8px;
            background: rgba(255,255,255,0.9);
            border-radius: 1rem;
        }
    </style>
}

@section Scripts {
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-draw/dist/leaflet.draw.js"></script>
    <script>
        const map = L.map('mapDraw').setView([58.333, 8.233], 13);
        L.tileLayer.wms('https://wms.geonorge.no/skwms1/wms.topo?', {
            layers: 'topo',
            format: 'image/png',
            transparent: false,
            attribution: '© Kartverket'
        }).addTo(map);

        const drawnItems = new L.FeatureGroup();
        map.addLayer(drawnItems);

        const drawControl = new L.Control.Draw({
            edit: { featureGroup: drawnItems },
            draw: {
                polygon: false,
                circle: false,
                rectangle: false,
                marker: true,
                polyline: true
            }
        });
        map.addControl(drawControl);

        map.on('draw:created', function (e) {
            drawnItems.clearLayers(); // Only one drawing at a time
            drawnItems.addLayer(e.layer);

            const geojson = e.layer.toGeoJSON();
            document.getElementById('geoInput').value = JSON.stringify(geojson.geometry.coordinates);
        });
    </script>
}
