@model NRL_PROJECT.Models.MapData

<div class="max-w-2xl mx-auto px-4 py-10">
    <h1 class="text-3xl font-bold text-purple-700 text-center mb-4">Enter your destination</h1>
    <p class="text-gray-700 text-center mb-8">Please register something about Maps below:</p>

    <form asp-action="MapView" method="post" class="space-y-6">
        <div>
            <label asp-for="CurrentLocation" class="block text-sm font-medium text-gray-800 mb-1">Current Location</label>
            <input asp-for="CurrentLocation" class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500" />
        </div>

        <div>
            <label asp-for="DescriptionOfLocation" class="block text-sm font-medium text-gray-800 mb-1">Description Of Location</label>
            <input asp-for="DescriptionOfLocation" class="w-full border border-gray-300 rounded px-3 py-2 focus:outline-none focus:ring-2 focus:ring-purple-500" />
        </div>

        <div class="mt-6">
            <h2 class="text-lg font-semibold text-purple-700 mb-2">Preview Location</h2>
            <div id="mapPreview" style="height: 300px;" class="rounded shadow"></div>
        </div>

        <div class="text-center mt-6">
            <button type="submit" class="bg-yellow-600 text-black px-6 py-2 rounded hover:bg-orange-700 transition">
                Register Location
            </button>
        </div>
    </form>

    <div class="mt-10">
        <h2 class="text-xl font-semibold text-blue-700 mb-4">Obstacle Map</h2>
        <div id="mapObstacles" style="height: 400px;" class="rounded shadow"></div>
    </div>
</div>

@section Scripts {
    <script>
        // Kart for forhåndsvisning av registrert posisjon
        var previewMap = L.map('mapPreview').setView([58.333, 8.233], 13);
        L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors'
        }).addTo(previewMap);

        // Legg inn en testmarkør (kan erstattes med @Model-data)
        L.marker([58.333, 8.233]).addTo(previewMap).bindPopup("Din posisjon").openPopup();

        // Kart for hindringer (GeoJSON)
        var obstacleMap = L.map('mapObstacles').setView([58.333, 8.233], 13);
        L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors'
        }).addTo(obstacleMap);

        // Hent hindringer fra controller
        fetch('/Home/GetObstacles')
            .then(response => response.json())
            .then(data => {
                L.geoJSON(data, {
                    onEachFeature: function (feature, layer) {
                        if (feature.properties && feature.properties.name) {
                            layer.bindPopup(feature.properties.name);
                        }
                    }
                }).addTo(obstacleMap);
            });
    </script>
}
